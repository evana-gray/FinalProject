[
  {
    "objectID": "Modeling.html",
    "href": "Modeling.html",
    "title": "Modeling",
    "section": "",
    "text": "This section of the project will focus on fitting statistical models to our dataset in hopes of being able to take in new information about an individual and predict if they have diabetes. A classification tree model and a random forest model, both of differing tuning parameters, will be compared to each other to determine which is more accurate. The initial steps will be the same as the EDA section - the data must be read in and factors will be created for our categorical variables.\nlibrary(tidyverse)\n\nWarning: package 'tidyverse' was built under R version 4.4.3\n\n\nWarning: package 'ggplot2' was built under R version 4.4.3\n\n\nWarning: package 'tidyr' was built under R version 4.4.3\n\n\nWarning: package 'readr' was built under R version 4.4.3\n\n\nWarning: package 'dplyr' was built under R version 4.4.3\n\n\nWarning: package 'stringr' was built under R version 4.4.3\n\n\nWarning: package 'forcats' was built under R version 4.4.3\n\n\nWarning: package 'lubridate' was built under R version 4.4.3\n\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   4.0.0     ✔ tibble    3.2.1\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nlibrary(tidymodels)\n\nWarning: package 'tidymodels' was built under R version 4.4.3\n\n\n── Attaching packages ────────────────────────────────────── tidymodels 1.4.1 ──\n✔ broom        1.0.9     ✔ rsample      1.3.1\n✔ dials        1.4.2     ✔ tailor       0.1.0\n✔ infer        1.0.9     ✔ tune         2.0.1\n✔ modeldata    1.5.1     ✔ workflows    1.3.0\n✔ parsnip      1.3.3     ✔ workflowsets 1.1.1\n✔ recipes      1.3.1     ✔ yardstick    1.3.2\n\n\nWarning: package 'broom' was built under R version 4.4.3\n\n\nWarning: package 'dials' was built under R version 4.4.3\n\n\nWarning: package 'scales' was built under R version 4.4.3\n\n\nWarning: package 'infer' was built under R version 4.4.3\n\n\nWarning: package 'modeldata' was built under R version 4.4.3\n\n\nWarning: package 'parsnip' was built under R version 4.4.3\n\n\nWarning: package 'recipes' was built under R version 4.4.3\n\n\nWarning: package 'rsample' was built under R version 4.4.3\n\n\nWarning: package 'tailor' was built under R version 4.4.3\n\n\nWarning: package 'tune' was built under R version 4.4.3\n\n\nWarning: package 'workflows' was built under R version 4.4.3\n\n\nWarning: package 'workflowsets' was built under R version 4.4.3\n\n\nWarning: package 'yardstick' was built under R version 4.4.3\n\n\n── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──\n✖ scales::discard() masks purrr::discard()\n✖ dplyr::filter()   masks stats::filter()\n✖ recipes::fixed()  masks stringr::fixed()\n✖ dplyr::lag()      masks stats::lag()\n✖ yardstick::spec() masks readr::spec()\n✖ recipes::step()   masks stats::step()\n\nlibrary(rsample)\nlibrary(parsnip)\nlibrary(tree)\n\nWarning: package 'tree' was built under R version 4.4.3\n\nlibrary(rpart)\n\nWarning: package 'rpart' was built under R version 4.4.3\n\n\n\nAttaching package: 'rpart'\n\nThe following object is masked from 'package:dials':\n\n    prune\n\nlibrary(rpart.plot)\n\nWarning: package 'rpart.plot' was built under R version 4.4.3\n\nlibrary(baguette)\n\nWarning: package 'baguette' was built under R version 4.4.3\n\nlibrary(ranger)\n\nWarning: package 'ranger' was built under R version 4.4.3\n\nlibrary(yardstick)\nlibrary(future)\n\nWarning: package 'future' was built under R version 4.4.3\n\n#set seed for repeatable results where randomization occurs. \nset.seed(16)\n\n#this command allows for parallel computing and faster run times\nplan(multisession, workers = 14)",
    "crumbs": [
      "EDA 1",
      "Modeling"
    ]
  },
  {
    "objectID": "Modeling.html#confusion-matrix",
    "href": "Modeling.html#confusion-matrix",
    "title": "Modeling",
    "section": "Confusion Matrix",
    "text": "Confusion Matrix\nThis confusion matrix gives a visualization of correct and incorrect predictions made by the model against the actual, full, dataset. From the plot it is evident the model correctly predicted that the vast majority of subjects had “no-diabetes”. It was less successful in predicting “diabetes” among subjects who actually had diabetes.\n\nrf_lastfit &lt;- extract_workflow(rf3_final_fit)\n\npredict_ds &lt;- diabetes_model_data |&gt;\n    mutate(\n      estimate = rf_lastfit |&gt;\n        predict(diabetes_model_data) )\n\nmatrix &lt;- conf_mat(\n  diabetes_model_data |&gt;\n    mutate(\n      estimate = rf_lastfit |&gt;\n        predict(diabetes_model_data) |&gt;\n        pull()),\n  diabetes_binary_f,\n  estimate\n    )\nmatrix\n\n             Truth\nPrediction    no diabetes diabetes\n  no diabetes      217870    34377\n  diabetes            464      969\n\nautoplot(matrix)\n\n\n\n\n\n\n\n\n\n#reset plan to default\nplan(sequential)",
    "crumbs": [
      "EDA 1",
      "Modeling"
    ]
  },
  {
    "objectID": "EDA.html",
    "href": "EDA.html",
    "title": "EDA",
    "section": "",
    "text": "Diabetes is an economically costly disease that can severely disrupt quality of life. The purpose of this project is to identify demographic and behavioral risk factors that could be used to predict diabetes. Such methods could inform clinical practice by alerting clinicians which patients could be at risk. This project’s data was sourced from the CDC’s 2015 Behavioral Risk Factor Surveillance System (BRFSS) and was accessed from www.kaggle.com.\nThe first task will be to read in and explore the dataset. This includes looking for missing values and creating data tables and plots to investigate the relationship between variables. This will help to determine what data elements are potential risk factors that we should include in our prediction models.\nlibrary(tidyverse)\n\nWarning: package 'tidyverse' was built under R version 4.4.3\n\n\nWarning: package 'ggplot2' was built under R version 4.4.3\n\n\nWarning: package 'tidyr' was built under R version 4.4.3\n\n\nWarning: package 'readr' was built under R version 4.4.3\n\n\nWarning: package 'dplyr' was built under R version 4.4.3\n\n\nWarning: package 'stringr' was built under R version 4.4.3\n\n\nWarning: package 'forcats' was built under R version 4.4.3\n\n\nWarning: package 'lubridate' was built under R version 4.4.3\n\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   4.0.0     ✔ tibble    3.2.1\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nlibrary(psych)\n\nWarning: package 'psych' was built under R version 4.4.3\n\n\n\nAttaching package: 'psych'\n\nThe following objects are masked from 'package:ggplot2':\n\n    %+%, alpha\n\nlibrary(ggplot2)\nlibrary(future)\n\nWarning: package 'future' was built under R version 4.4.3",
    "crumbs": [
      "EDA 1",
      "EDA"
    ]
  },
  {
    "objectID": "EDA.html#missing-values",
    "href": "EDA.html#missing-values",
    "title": "EDA",
    "section": "Missing Values",
    "text": "Missing Values\nWe can see below there are no missing values in our dataset for any variable including new factor variables.\n\n# write function to count NAs in a column\nsum_na &lt;- function(column) {\n  sum(is.na(column))\n}\n\n# operate function across all dataset columns\nna_counts &lt;- diabetes |&gt;\n  summarize(across(everything(), sum_na))\nna_counts\n\n# A tibble: 1 × 41\n  diabetes_binary highbp highchol cholcheck   bmi smoker stroke\n            &lt;int&gt;  &lt;int&gt;    &lt;int&gt;     &lt;int&gt; &lt;int&gt;  &lt;int&gt;  &lt;int&gt;\n1               0      0        0         0     0      0      0\n# ℹ 34 more variables: heartdiseaseorattack &lt;int&gt;, physactivity &lt;int&gt;,\n#   fruits &lt;int&gt;, veggies &lt;int&gt;, hvyalcoholconsump &lt;int&gt;, anyhealthcare &lt;int&gt;,\n#   nodocbccost &lt;int&gt;, genhlth &lt;int&gt;, menthlth &lt;int&gt;, physhlth &lt;int&gt;,\n#   diffwalk &lt;int&gt;, sex &lt;int&gt;, age &lt;int&gt;, education &lt;int&gt;, income &lt;int&gt;,\n#   diabetes_binary_f &lt;int&gt;, highbp_f &lt;int&gt;, highchol_f &lt;int&gt;,\n#   cholcheck_f &lt;int&gt;, smoker_f &lt;int&gt;, stroke_f &lt;int&gt;,\n#   heartdiseaseorattack_f &lt;int&gt;, physactivity_f &lt;int&gt;, fruits_f &lt;int&gt;, …",
    "crumbs": [
      "EDA 1",
      "EDA"
    ]
  },
  {
    "objectID": "EDA.html#exploring-variables-of-interest",
    "href": "EDA.html#exploring-variables-of-interest",
    "title": "EDA",
    "section": "Exploring Variables of interest",
    "text": "Exploring Variables of interest\nThe first two variables of interest were income and age. One-way, two-way, and grouped bar plots were produced to gather more insight. The frequency distribution plot is immediately the most informative as it shows quickly which age groups and which income bands are the most prevalent in the data set. It is difficult to compare diabetes prevalence among income groups just looking at counts. More meaningful analyses will need to include a rate that can be easily compared across categories.\n\nAge and Income\n\n#diabetes status by income \ndiabetes |&gt;\n  group_by(income_f, diabetes_binary_f) |&gt;\n  summarize(count = n()) |&gt;\n  pivot_wider(names_from = diabetes_binary_f, values_from = count)\n\n`summarise()` has grouped output by 'income_f'. You can override using the\n`.groups` argument.\n\n\n# A tibble: 8 × 3\n# Groups:   income_f [8]\n  income_f `no diabetes` diabetes\n  &lt;fct&gt;            &lt;int&gt;    &lt;int&gt;\n1 &lt; 10k             7428     2383\n2 &lt; 15k             8697     3086\n3 &lt; 20k            12426     3568\n4 &lt; 25k            16081     4054\n5 &lt; 35k            21379     4504\n6 &lt; 50k            31179     5291\n7 &lt; 75k            37954     5265\n8 75k+             83190     7195\n\n#diabetes status by age and income \ndiabetes |&gt;\n  group_by(age_f, income_f) |&gt;\n  summarize(count = n()) |&gt;\n  pivot_wider(names_from = income_f, values_from = count)\n\n`summarise()` has grouped output by 'age_f'. You can override using the\n`.groups` argument.\n\n\n# A tibble: 13 × 9\n# Groups:   age_f [13]\n   age_f      `&lt; 10k` `&lt; 15k` `&lt; 20k` `&lt; 25k` `&lt; 35k` `&lt; 50k` `&lt; 75k` `75k+`\n   &lt;fct&gt;        &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;  &lt;int&gt;\n 1 18 to 24       470     289     514     650     741     858     764   1414\n 2 25 to 29       312     277     483     679     895    1320    1502   2130\n 3 30 to 34       438     331     598     708    1025    1572    2072   4379\n 4 35 to 39       434     389     644     830    1012    1662    2394   6458\n 5 40 to 44       544     499     692     861    1043    1684    2603   8231\n 6 45 to 49       782     662     896    1108    1266    2112    3134   9859\n 7 50 to 54      1297    1069    1312    1456    1926    2977    4359  11918\n 8 55 to 59      1448    1398    1635    1861    2304    3729    5393  13064\n 9 60 to 64      1320    1562    1949    2298    3071    4828    6192  12024\n10 65 to 69       945    1632    1991    2661    3772    5478    6084   9631\n11 70 to 74       711    1301    1719    2419    3234    4348    4097   5704\n12 75 to 79       508    1042    1486    2078    2551    2843    2417   3055\n13 80 to high     602    1332    2075    2526    3043    3059    2208   2518\n\n#distribution of age by income\n#evident higher income is more common between middle-age\nggplot(diabetes, aes(x = age_f , fill = income_f)) + \n  geom_bar() +\n  labs(title = \"Frequency Distribution of Age and Income\", x = \"Age Category\", y = \"Observations\") +\n  theme(plot.title = element_text(hjust = 0.5),\n    legend.position = \"top\", legend.box = \"horizontal\") +\n  scale_fill_discrete(guide = guide_legend(nrow=1))\n\n\n\n\n\n\n\n\n\n\nDiabetes prevalence\nHere a rate of diabetes per 1,000 is calculated to allow for quick determination of what demographic and behavioral risk factors have the highest prevalance of diabetes in our dataset. Apparent in the summaries below is that diabetes is most prevalent in males, aged 70 - 74, with incomes between 0 and 15k, who do not consume alcohol heavily, with high blood pressure (BP).\n\n# diabetes prevalence tables\ndiabetes |&gt;\n  group_by(sex_f) |&gt;\n  summarize(PrevalencePer1000 = (sum(diabetes_binary == 1)/n())*1000) |&gt;\n  arrange(desc(PrevalencePer1000))\n\n# A tibble: 2 × 2\n  sex_f  PrevalencePer1000\n  &lt;fct&gt;              &lt;dbl&gt;\n1 male                152.\n2 female              130.\n\ndiabetes |&gt;\n  group_by(income_f) |&gt;\n  summarize(PrevalencePer1000 = (sum(diabetes_binary == 1)/n())*1000) |&gt;\n  arrange(desc(PrevalencePer1000))\n\n# A tibble: 8 × 2\n  income_f PrevalencePer1000\n  &lt;fct&gt;                &lt;dbl&gt;\n1 &lt; 15k                262. \n2 &lt; 10k                243. \n3 &lt; 20k                223. \n4 &lt; 25k                201. \n5 &lt; 35k                174. \n6 &lt; 50k                145. \n7 &lt; 75k                122. \n8 75k+                  79.6\n\ndiabetes |&gt;\n  group_by(hvyalcoholconsump_f) |&gt;\n  summarize(PrevalencePer1000 = (sum(diabetes_binary == 1)/n())*1000) |&gt;\n  arrange(desc(PrevalencePer1000))\n\n# A tibble: 2 × 2\n  hvyalcoholconsump_f PrevalencePer1000\n  &lt;fct&gt;                           &lt;dbl&gt;\n1 no                              144. \n2 yes                              58.4\n\ndiabetes |&gt;\n  group_by(age_f) |&gt;\n  summarize(PrevalencePer1000 = (sum(diabetes_binary == 1)/n())*1000) |&gt;\n  arrange(desc(PrevalencePer1000))\n\n# A tibble: 13 × 2\n   age_f      PrevalencePer1000\n   &lt;fct&gt;                  &lt;dbl&gt;\n 1 70 to 74               218. \n 2 75 to 79               213. \n 3 65 to 69               204. \n 4 80 to high             185. \n 5 60 to 64               172. \n 6 55 to 59               138. \n 7 50 to 54               117. \n 8 45 to 49                87.9\n 9 40 to 44                65.0\n10 35 to 39                45.3\n11 30 to 34                28.2\n12 25 to 29                18.4\n13 18 to 24                13.7\n\n# two way contingency table of prevalence by high blood pressure and high cholesterol\ndiabetes |&gt;\n  group_by(highbp_f, highchol_f) |&gt;\n  summarize(PrevalencePer1000 = (sum(diabetes_binary == 1)/n())*1000) |&gt;\n  arrange(desc(PrevalencePer1000)) |&gt;\n  pivot_wider(names_from = highchol_f, values_from = PrevalencePer1000)\n\n`summarise()` has grouped output by 'highbp_f'. You can override using the\n`.groups` argument.\n\n\n# A tibble: 2 × 3\n# Groups:   highbp_f [2]\n  highbp_f   `high cholesterol` `no high cholesterol`\n  &lt;fct&gt;                   &lt;dbl&gt;                 &lt;dbl&gt;\n1 high BP                  297.                 167. \n2 no high BP               104.                  41.9\n\n# two way contingency table of prevalence across mental health and physical health levels\ndiabetes |&gt;\n  group_by(smoker_f, hvyalcoholconsump_f) |&gt;\n  summarize(PrevalencePer1000 = (sum(diabetes_binary == 1)/n())*1000) |&gt;\n  arrange(desc(PrevalencePer1000)) |&gt;\n  pivot_wider(names_from = smoker_f, values_from = PrevalencePer1000)\n\n`summarise()` has grouped output by 'smoker_f'. You can override using the\n`.groups` argument.\n\n\n# A tibble: 2 × 3\n  hvyalcoholconsump_f   yes    no\n  &lt;fct&gt;               &lt;dbl&gt; &lt;dbl&gt;\n1 no                  172.  123. \n2 yes                  66.8  42.7\n\n\nIt seems counter-intuitive that heavy alcohol use is associated with lower diabetes prevalence so more investigation was done to see how high alcohol usage is distributed among other factors like age and income. The two bar charts below show that heavy alcohol use is more common among lower-aged but higher income groups. The previous analysis showed diabetes is more prevalent in older and lower income groups. Heavy alcohol use may not be a worthwhile variable to include in our predictive models.\n\n#view proportion of heavy drinkers by income level, age, and sex\nalc_inc_df &lt;- diabetes |&gt;\n  group_by(income_f, sex_f) |&gt;\n  summarize(PrevalencePer1000 = (sum(hvyalcoholconsump == 1)/n())*1000)\n\n`summarise()` has grouped output by 'income_f'. You can override using the\n`.groups` argument.\n\nggplot(alc_inc_df, aes(x = income_f , y = PrevalencePer1000, fill = sex_f)) + \n  geom_bar(stat = \"identity\") +\n  labs(title = \"Heavy Drinking Rate by Income and Sex\", x = \"Income Level\", y = \"Incidence of Heavy Drinking (per 1000)\") +\n  theme(plot.title = element_text(hjust = 0.5), legend.position = \"top\", legend.box = \"horizontal\") +\n  scale_fill_discrete(guide = guide_legend(nrow=1))\n\n\n\n\n\n\n\nalc_age_df &lt;- diabetes |&gt;\n  group_by(age_f, sex_f) |&gt;\n  summarize(PrevalencePer1000 = (sum(hvyalcoholconsump == 1)/n())*1000)\n\n`summarise()` has grouped output by 'age_f'. You can override using the\n`.groups` argument.\n\nggplot(alc_age_df, aes(x = age_f , y = PrevalencePer1000, fill = sex_f)) + \n  geom_bar(stat = \"identity\") +\n  labs(title = \"Heavy Drinking Rate by Age and Sex\", x = \"Age Level\", y = \"Incidence of Heavy Drinking (per 1000)\") +\n  theme(plot.title = element_text(hjust = 0.5), legend.position = \"top\", legend.box = \"horizontal\") +\n  scale_fill_discrete(guide = guide_legend(nrow=1))\n\n\n\n\n\n\n\n\n\n\nMental Health\nNext we will investigate if the number of reported “poor mental health days” would be a worthwhile variable to include in the model. We can see that this variable is sparsely populated with values greater than 0 and the diabetes prevalence is not much greater among the group with non-zero poor mental health days.\n\n#general numeric summary of the mental health numeric variable - range is 0-30 with many zero responses\n\nggplot(diabetes, aes(x = menthlth)) +\n  geom_density() + \n  labs(title = \"Frequency of Poor Mental Health Days\", x = \"# of Reported Poor Mental Health Days\", y = \"Relative Frequency\") +\n  theme(plot.title = element_text(hjust = 0.5))\n\n\n\n\n\n\n\n#create mental health binary and see percentage with a non-zero response\n#diabetes is more prevalent \ndiabetes |&gt;\n  mutate(mentalhealth_flag = if_else(menthlth == 0, \"none\", \"1+\")) |&gt;\n  group_by(mentalhealth_flag) |&gt;\n  summarize(count = n(),\n            PrevalencePer1000 = (sum(diabetes_binary == 1)/n())*1000) |&gt;\n  mutate(\"Col%\" = round((count/253680)*100,2))\n\n# A tibble: 2 × 4\n  mentalhealth_flag  count PrevalencePer1000 `Col%`\n  &lt;chr&gt;              &lt;int&gt;             &lt;dbl&gt;  &lt;dbl&gt;\n1 1+                 78000              153.   30.8\n2 none              175680              133.   69.2\n\n\n\n\nBMI\nBody-mass index (BMI) is another variable of interest. It has a much more “normal” looking distribution than mental health days and those with BMI values above the median BMI value of 27 have a significantly higher prevalence of diabetes.\n\n#ggplot showing BMI is much more consistently populated throughout the dataset than the mental health variable\nggplot(diabetes, aes(x = bmi)) +\n  geom_density() +\n  labs(title = \"Frequency of BMI Values\", x = \"BMI\", y = \"Relative Frequency\") +\n  theme(plot.title = element_text(hjust = 0.5))\n\n\n\n\n\n\n\n#prevalence per 1000 is more than double for those with BMI above the Median\ndiabetes |&gt;\n  mutate(BMI_flag = if_else(bmi &gt; 27, \"Above Median BMI\", \"Below Median BMI\")) |&gt;\n  group_by(BMI_flag) |&gt;\n  summarize(count = n(),\n            PrevalencePer1000 = (sum(diabetes_binary == 1)/n())*1000) |&gt;\n  mutate(\"Col%\" = round((count/253680)*100,2))\n\n# A tibble: 2 × 4\n  BMI_flag          count PrevalencePer1000 `Col%`\n  &lt;chr&gt;             &lt;int&gt;             &lt;dbl&gt;  &lt;dbl&gt;\n1 Above Median BMI 119286             210.    47.0\n2 Below Median BMI 134394              76.7   53.0\n\n\nBelow is a visual demonstration of the difference in BMI distributions among those with diabetes and those without diabetes. It is clear BMI values do differ between those with and without diabetes in our dataset and it is an informative numeric variable to consider.\n\nggplot(diabetes, aes(x = bmi, fill = diabetes_binary_f)) +\n  geom_density(alpha = 0.5) +\n  labs(title = \"Frequency of BMI Values by Diabetes Status\", x = \"BMI\", y = \"Relative Frequency\") +\n  theme(plot.title = element_text(hjust = 0.5), legend.position = \"top\", legend.box = \"horizontal\") +\n  scale_fill_discrete(guide = guide_legend(nrow=1))",
    "crumbs": [
      "EDA 1",
      "EDA"
    ]
  }
]